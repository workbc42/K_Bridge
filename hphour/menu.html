<!DOCTYPE html>
<html lang="ko" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Happy Hour Thai Menu Board</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Kanit:wght@400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#B61E2E",
            secondary: "#D4AF37",
            "bg-soft": "#F7F4EE",
            "bg-deep": "#111315"
          },
          fontFamily: {
            sans: ["Noto Sans KR", "sans-serif"],
            thai: ["Kanit", "sans-serif"],
            display: ["Playfair Display", "serif"]
          }
        }
      }
    };
  </script>
  <style>
    .sidebar-scroll::-webkit-scrollbar { width: 6px; }
    .sidebar-scroll::-webkit-scrollbar-thumb { background: #d9dde2; border-radius: 9999px; }
    .thai-script { font-family: 'Kanit', sans-serif; }
    .active-cat { background: #B61E2E; color: #fff; box-shadow: 0 10px 20px rgba(182, 30, 46, 0.2); }
  </style>
</head>
<body class="bg-bg-soft dark:bg-bg-deep text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300">
  <div class="flex h-screen overflow-hidden">
    <aside class="hidden lg:flex w-72 flex-shrink-0 bg-white dark:bg-zinc-900 border-r border-slate-200 dark:border-zinc-800 flex-col">
      <div class="p-6 border-b border-slate-100 dark:border-zinc-800">
        <h1 id="brandTitle" class="text-2xl font-display font-bold text-primary italic">Happy Hour Thai Kitchen</h1>
        <p id="brandSub" class="text-xs text-slate-500 dark:text-slate-400 mt-1 uppercase tracking-widest">Digital Menu Board</p>
      </div>

      <div class="px-4 pt-4">
        <div class="inline-flex rounded-full bg-slate-100 dark:bg-zinc-800 p-1 gap-1 w-full">
          <button class="lang-btn flex-1 rounded-full px-3 py-1.5 text-xs font-semibold bg-primary text-white" data-lang="ko">한국어</button>
          <button class="lang-btn flex-1 rounded-full px-3 py-1.5 text-xs font-semibold" data-lang="en">English</button>
          <button class="lang-btn flex-1 rounded-full px-3 py-1.5 text-xs font-semibold" data-lang="th">Thai</button>
        </div>
      </div>

      <nav id="categoryNav" class="flex-1 overflow-y-auto sidebar-scroll py-4 px-3 space-y-1"></nav>

      <div class="p-4 border-t border-slate-100 dark:border-zinc-800">
        <button id="themeToggle" class="flex items-center justify-center w-full p-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-zinc-800 transition-colors">
          <span class="material-icons mr-1">dark_mode</span>
          <span id="themeLabel" class="text-sm">테마 전환</span>
        </button>
      </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-4 md:p-8">
      <header class="mb-8 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
        <div>
          <h2 id="pageTitle" class="text-3xl font-bold mb-2">태국 메뉴판</h2>
          <p id="pageDesc" class="text-slate-500 dark:text-slate-400">카테고리별로 메뉴를 확인하고 검색으로 빠르게 찾으세요.</p>
        </div>

        <div class="w-full md:w-96 space-y-3">
          <div class="lg:hidden inline-flex rounded-full bg-white dark:bg-zinc-900 border border-slate-200 dark:border-zinc-800 p-1 gap-1 w-full">
            <button class="lang-btn flex-1 rounded-full px-3 py-1.5 text-xs font-semibold bg-primary text-white" data-lang="ko">한국어</button>
            <button class="lang-btn flex-1 rounded-full px-3 py-1.5 text-xs font-semibold" data-lang="en">English</button>
            <button class="lang-btn flex-1 rounded-full px-3 py-1.5 text-xs font-semibold" data-lang="th">Thai</button>
          </div>

          <div class="relative">
            <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">search</span>
            <input id="searchInput" type="text" class="w-full pl-10 pr-4 py-2.5 rounded-full border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 focus:outline-none focus:ring-2 focus:ring-primary/20" placeholder="메뉴 검색" />
          </div>
          <a href="#cartPanel" id="cartJumpBtn" class="inline-flex items-center justify-center gap-2 rounded-full border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 px-4 py-2 text-sm font-semibold">
            <span class="material-icons text-base">shopping_cart</span>
            <span id="cartJumpText">장바구니</span>
            <span id="cartJumpCount" class="inline-flex h-6 min-w-6 items-center justify-center rounded-full bg-primary px-2 text-xs text-white">0</span>
          </a>
        </div>
      </header>

      <div class="grid grid-cols-1 xl:grid-cols-[minmax(0,1fr)_360px] gap-6 items-start">
        <div id="menuSections" class="space-y-12"></div>

        <aside id="cartPanel" class="xl:sticky xl:top-6 rounded-2xl border border-slate-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 shadow-sm overflow-hidden">
          <div class="px-5 py-4 border-b border-slate-100 dark:border-zinc-800">
            <h3 id="cartTitle" class="text-lg font-bold">장바구니</h3>
            <p id="cartHint" class="text-xs text-slate-500 dark:text-slate-400 mt-1">메뉴를 추가하고 주문을 진행하세요.</p>
          </div>
          <div id="cartItems" class="max-h-[45vh] overflow-y-auto sidebar-scroll px-4 py-3 space-y-2"></div>
          <div class="px-5 py-4 border-t border-slate-100 dark:border-zinc-800 space-y-3">
            <div class="flex items-center justify-between text-sm">
              <span id="subtotalLabel" class="text-slate-600 dark:text-slate-300">합계</span>
              <strong id="cartSubtotal" class="text-base">0원</strong>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <button id="clearCartBtn" class="rounded-lg border border-slate-200 dark:border-zinc-700 px-3 py-2 text-sm font-semibold hover:bg-slate-50 dark:hover:bg-zinc-800">비우기</button>
              <button id="orderBtn" class="rounded-lg bg-primary text-white px-3 py-2 text-sm font-semibold hover:opacity-95">주문하기</button>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <div id="orderModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/45" data-close-order-modal></div>
    <div class="absolute inset-0 p-4 md:p-8 flex items-center justify-center">
      <div class="w-full max-w-lg rounded-2xl bg-white dark:bg-zinc-900 border border-slate-200 dark:border-zinc-700 shadow-xl overflow-hidden">
        <div class="px-5 py-4 border-b border-slate-100 dark:border-zinc-800 flex items-center justify-between">
          <h3 id="orderTitle" class="text-lg font-bold">주문 정보</h3>
          <button type="button" data-close-order-modal class="rounded-full p-1 hover:bg-slate-100 dark:hover:bg-zinc-800">
            <span class="material-icons">close</span>
          </button>
        </div>
        <form id="orderForm" class="px-5 py-4 space-y-3">
          <div>
            <label id="customerNameLabel" class="text-sm font-medium">주문자명</label>
            <input id="customerNameInput" type="text" class="mt-1 w-full rounded-lg border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-950 px-3 py-2" />
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label id="tableLabel" class="text-sm font-medium">테이블 번호</label>
              <input id="tableInput" type="text" class="mt-1 w-full rounded-lg border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-950 px-3 py-2" />
            </div>
            <div>
              <label id="phoneLabel" class="text-sm font-medium">연락처</label>
              <input id="phoneInput" type="text" class="mt-1 w-full rounded-lg border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-950 px-3 py-2" />
            </div>
          </div>
          <div>
            <label id="requestLabel" class="text-sm font-medium">요청사항</label>
            <textarea id="requestInput" rows="3" class="mt-1 w-full rounded-lg border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-950 px-3 py-2"></textarea>
          </div>
          <div class="rounded-lg bg-slate-50 dark:bg-zinc-800/80 px-3 py-2 text-sm">
            <div class="flex items-center justify-between">
              <span id="orderTotalLabel">주문 합계</span>
              <strong id="modalOrderTotal">0원</strong>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-2 pt-1">
            <button type="button" data-close-order-modal id="cancelOrderBtn" class="rounded-lg border border-slate-200 dark:border-zinc-700 px-3 py-2 text-sm font-semibold hover:bg-slate-50 dark:hover:bg-zinc-800">취소</button>
            <button type="submit" id="submitOrderBtn" class="rounded-lg bg-primary text-white px-3 py-2 text-sm font-semibold hover:opacity-95">주문 접수</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const menuData = [


            { name: "팟카파오 무쌉/가이", thai: "ผัดกะเพราหมูสับ/ไก่", desc: "돼지고기/닭고기 바질 볶음 덮밥", category: "덮밥류", price: 12000 },
            { name: "팟카파오 느아", thai: "ผัดกะเพราเนื้อ", desc: "소고기 바질 볶음 덮밥", category: "덮밥류", price: 13000 },
            { name: "팟카파오 탈레", thai: "ผัดกะเพราทะเล", desc: "해산물 바질 볶음 덮밥", category: "덮밥류", price: 15000 },
            { name: "카오 팟 무", thai: "ข้าวผัดหมู", desc: "돼지고기 볶음밥", category: "덮밥류", price: 12000 },
            { name: "카오 팟 꿍", thai: "ข้าวผัดกุ้ง", desc: "새우 볶음밥", category: "덮밥류", price: 15000 },
            { name: "카오 팟 탈레", thai: "ข้าวผัดทะเล", desc: "해산물 볶음밥", category: "덮밥류", price: 15000 },
            { name: "카오 무 팟 프릭깽 따이", thai: "ข้าวหมูผัดพริกแกงใต้", desc: "남부식 돼지고기 레드커리 덮밥", category: "덮밥류", price: 12000 },
            { name: "카오 탈레 팟 프릭깽 따이", thai: "ข้าวทะเลผัดพริกแกงใต้", desc: "남부식 해산물 레드커리 덮밥", category: "덮밥류", price: 15000 },
            { name: "카오 팟 프릭깽 무껍", thai: "ข้าวผัดพริกแกงหมูกรอบ", desc: "삼겹살 튀김 레드커리 덮밥", category: "덮밥류", price: 15000 },
            { name: "카오 팟 프릭깽 탈레", thai: "ข้าวผัดพริกแกงทะเล", desc: "해산물 레드커리 볶음 덮밥", category: "덮밥류", price: 15000 },
            { name: "카오 카나 무막", thai: "ข้าวคะน้าหมูหมัก", desc: "케일 돼지고기 볶음 덮밥", category: "덮밥류", price: 12000 },
            { name: "카오 무텃 크라티얌", thai: "ข้าวหมูทอดกระเทียม", desc: "돼지고기 마늘 튀김 덮밥", category: "덮밥류", price: 12000 },
            { name: "팟카파오 무쌉/가이", thai: "ผัดกะเพราหมูสับ/ไก่", desc: "돼지고기/닭고기 바질 볶음 - 요리", category: "메인 요리", price: 12000 },
            { name: "팟카파오 느아 막", thai: "ผัดกะเพราเนื้อหมาก", desc: "숙성 소고기 바질 볶음", category: "메인 요리", price: 13000 },
            { name: "팟카파오 탈레", thai: "ผัดกะเพราทะเล", desc: "해산물 바질 볶음", category: "메인 요리", price: 15000 },
            { name: "무 팟 프릭깽 따이", thai: "หมูผัดพริกแกงใต้", desc: "남부식 돼지고기 레드커리 볶음", category: "메인 요리", price: 12000 },
            { name: "탈레 팟 프릭깽 따이", thai: "ทะเลผัดพริกแกงใต้", desc: "남부식 해산물 레드커리 볶음", category: "메인 요리", price: 15000 },
            { name: "플라둑 팟 프릭깽 따이", thai: "ปลาดุกผัดพริกแกงใต้", desc: "남부식 메기 레드커리 볶음", category: "메인 요리", price: 15000 },
            { name: "플라둑 팟 차", thai: "ปลาดุกผัดฉ่า", desc: "메기 매운 허브 볶음", category: "메인 요리", price: 15000 },
            { name: "꼽 팟 차", thai: "กบผัดฉ่า", desc: "개구리 매운 허브 볶음", category: "메인 요리", price: 17000 },
            { name: "카나 무 막", thai: "คะน้าหมูหมาก", desc: "케일 돼지고기 볶음", category: "메인 요리", price: 12000 },
            { name: "쿠아 클링 무", thai: "คั่วกลิ้งหมู", desc: "남부식 드라이 카레 돼지고기 볶음", category: "메인 요리", price: 12000 },
            { name: "팟 허이 라이", thai: "ผัดหอยลาย", desc: "매운 조개 볶음", category: "메인 요리", price: 12000 },
            { name: "플라믁 팟 카이켐", thai: "ปลาหมึกผัดไข่เค็ม", desc: "오징어 쏠티드 에그 볶음", category: "메인 요리", price: 15000 },
            { name: "꿍 팟 퐁커리", thai: "กุ้งผัดผงกะหรี่", desc: "새우 커리 가루 볶음", category: "메인 요리", price: 15000 },
            { name: "푸님 팟 퐁커리", thai: "ปูนิ่มผัดผงกะหรี่", desc: "소프트크랩 커리 가루 볶음", category: "메인 요리", price: 15000 },
            { name: "남프릭 까삐 + 플라투", thai: "น้ำพริกกะปิ + ปลาทู", desc: "새우젓 소스 + 고등어 튀김 세트", category: "메인 요리", price: 15000 },
            { name: "꿍 채 남플라", thai: "กุ้งแช่น้ำปลา", desc: "태국식 생새우 회", category: "메인 요리", price: 15000 },
            { name: "꼽 텃 크라티얌", thai: "กบทอดกระเทียม", desc: "개구리 마늘 튀김", category: "메인 요리", price: 17000 },
            { name: "무 마나오", thai: "หมูมะนาว", desc: "매콤 새콤한 돼지고기 샤브 샐러드", category: "메인 요리", price: 13000 },
            { name: "믁 마나오", thai: "หมึกมะนาว", desc: "매콤 새콤한 오징어 데침", category: "메인 요리", price: 17000 },
            { name: "플라 탑팀 쌈롯", thai: "ปลาทับทิมสามรส", desc: "세 가지 맛 소스 붉은 틸라피아 튀김", category: "메인 요리", price: 30000 },
            { name: "플라 탑팀 루이 수언", thai: "ปลาทับทิมลุยสวน", desc: "허브 샐러드 곁들인 붉은 틸라피아 튀김", category: "메인 요리", price: 30000 },
            { name: "팟씨유 무 막", thai: "ผัดซีอิ๊วหมูหมาก", desc: "돼지고기 간장 볶음면", category: "면 요리", price: 12000 },
            { name: "팟씨유 탈레", thai: "ผัดซีอิ๊วทะเล", desc: "해산물 간장 볶음면", category: "면 요리", price: 15000 },
            { name: "랏나 무 막", thai: "ราดหน้าหมูหมาก", desc: "걸쭉한 울면 스타일 돼지고기 국수", category: "면 요리", price: 12000 },
            { name: "랏나 탈레", thai: "ราดหน้าทะเล", desc: "걸쭉한 울면 스타일 해산물 국수", category: "면 요리", price: 15000 },
            { name: "팟타이 무 막", thai: "ผัดไทยหมูหมาก", desc: "돼지고기 팟타이", category: "면 요리", price: 12000 },
            { name: "팟타이 꿍", thai: "ผัดไทยกุ้ง", desc: "새우 팟타이", category: "면 요리", price: 15000 },
            { name: "꾸어이띠여우 르아", thai: "ก๋วยเตี๋ยวเรือ", desc: "진한 선지 국물 쌀국수", category: "면 요리", price: 12000 },
            { name: "꾸어이띠여우 남사이", thai: "ก๋วยเตี๋ยวน้ำใส", desc: "맑은 국물 쌀국수", category: "면 요리", price: 12000 },
            { name: "꾸어이잡 까이 남콘", thai: "ก๋วยจั๊บไก่น้ำข้น", desc: "진한 국물 닭고기 국수", category: "면 요리", price: 13000 },
            { name: "꾸어이띠여우 쌥 행", thai: "ก๋วยเตี๋ยวแห้ง", desc: "매운 비빔 국수", category: "면 요리", price: 12000 },
            { name: "바미 까이 칙", thai: "บะหมี่ไก่ฉีก", desc: "찢은 닭고기 에그 누들", category: "면 요리", price: 10000 },
            { name: "바미 끼여우 무댕 (행/남)", thai: "บะหมี่เกี๊ยวหมูแดง (แห้ง/น้ำ)", desc: "완탕 & 붉은 돼지고기 에그 누들 - 비빔/물", category: "면 요리", price: 12000 },
            { name: "끼여우 남", thai: "เกี๊ยวน้ำ", desc: "완탕 스프", category: "면 요리", price: 10000 },
            { name: "수키 남 무", thai: "สุกี้น้ำหมู", desc: "태국식 스키야키 국수 - 돼지", category: "면 요리", price: 12000 },
            { name: "수키 남 탈레", thai: "สุกี้น้ำทะเล", desc: "태국식 스키야키 국수 - 해산물", category: "면 요리", price: 15000 },
            { name: "카놈찐 남야 빠", thai: "ขนมจีนน้ำยาป่า", desc: "쌀소면 + 맑은 생선 카레", category: "면 요리", price: 13000 },
            { name: "카놈찐 남야 까티 따이", thai: "ขนมจีนน้ำยากะทิใต้", desc: "쌀소면 + 남부식 코코넛 카레", category: "면 요리", price: 12000 },
            { name: "카놈찐 깽 따이 플라", thai: "ขนมจีนแกงใต้ปลา", desc: "쌀소면 + 생선 내장 카레", category: "면 요리", price: 12000 },
            { name: "똠카 까이", thai: "ต้มข่าไก่", desc: "코코넛 밀크 닭고기 스프", category: "찌개/국/커리", price: 13000 },
            { name: "똠얌 꿍", thai: "ต้มยำกุ้ง", desc: "새우 똠얌찌개", category: "찌개/국/커리", price: 15000 },
            { name: "똠얌 탈레", thai: "ต้มยำทะเล", desc: "해산물 똠얌찌개", category: "찌개/국/커리", price: 15000 },
            { name: "똠얌 뽀텍 탈레", thai: "ต้มยำโป๊ะแตกทะเล", desc: "매운 맑은 해산물 찌개", category: "찌개/국/커리", price: 17000 },
            { name: "똠 플라투 바이 마캄", thai: "ต้มปลาทูใบมะขาม", desc: "타마린드 잎 고등어 찌개", category: "찌개/국/커리", price: 17000 },
            { name: "똠 슈퍼 틴 까이", thai: "ต้มซุปเปอร์ตีนไก่", desc: "매콤한 닭발 스프", category: "찌개/국/커리", price: 15000 },
            { name: "깽쏨 꿍 차옴 카이", thai: "แกงส้มกุ้งชะอมไข่", desc: "새우 & 아카시아 계란말이 쏨 카레", category: "찌개/국/커리", price: 15000 },
            { name: "깽 리양 꿍 솟", thai: "แกงเลียงกุ้งสด", desc: "새우 야채 스프", category: "찌개/국/커리", price: 15000 },
            { name: "깽쯧 따오후 무쌉", thai: "แกงจืดเต้าหู้หมูสับ", desc: "맑은 연두부 돼지고기 국", category: "찌개/국/커리", price: 12000 },
            { name: "깽 까티 까이 너마이", thai: "แกงกะทิไก่หน่อไม้", desc: "닭고기 죽순 코코넛 커리", category: "찌개/국/커리", price: 13000 },
            { name: "깽 까티 무 사이 팍통", thai: "แกงกะทิหมูใส่ฟักทอง", desc: "돼지고기 단호박 코코넛 커리", category: "찌개/국/커리", price: 13000 },
            { name: "깽 키여우 완 까이", thai: "แกงเขียวหวานไก่", desc: "닭고기 그린 커리", category: "찌개/국/커리", price: 13000 },
            { name: "깽 따이 플라", thai: "แกงใต้ปลา", desc: "남부식 생선 내장 커리 - 아주 매움", category: "찌개/국/커리", price: 13000 },
            { name: "깽 파 플라둑", thai: "แกงป่าปลาดุก", desc: "메기 정글 커리 - 코코넛X, 매움", category: "찌개/국/커리", price: 15000 },
            { name: "파냉 무", thai: "พะแนงหมู", desc: "진한 파냉 커리 돼지고기", category: "찌개/국/커리", price: 12000 },
            { name: "마싸만 까이", thai: "มัสมั่นไก่", desc: "마싸만 치킨 커리", category: "찌개/국/커리", price: 13000 },
            { name: "땀 타이", thai: "ตำไทย", desc: "기본 쏨땀 - 새콤달콤", category: "쏨땀", price: 10000 },
            { name: "땀 뿌 쁠라라", thai: "ตำปูปลาร้า", desc: "절인 게 & 젓갈 쏨땀 - 짭짤하고 진한 맛", category: "쏨땀", price: 12000 },
            { name: "땀 타이 카이켐", thai: "ตำไทยไข่เค็ม", desc: "쏠티드 에그 쏨땀", category: "쏨땀", price: 13000 },
            { name: "땀 카오폿 카이켐", thai: "ตำข้าวโพดไข่เค็ม", desc: "옥수수 & 쏠티드 에그 쏨땀", category: "쏨땀", price: 15000 },
            { name: "땀 마무앙", thai: "ตำมะม่วง", desc: "그린 망고 샐러드", category: "쏨땀", price: 13000 },
            { name: "땀 투아 팍야오", thai: "ตำถั่วฝักยาว", desc: "줄기콩 쏨땀", category: "쏨땀", price: 13000 },
            { name: "땀 꿍 솟", thai: "ตำกุ้งสด", desc: "생새우 쏨땀", category: "쏨땀", price: 15000 },
            { name: "땀 허이 크랭", thai: "ตำหอยแครง", desc: "꼬막 쏨땀", category: "쏨땀", price: 15000 },
            { name: "땀 빠", thai: "ตำป่า", desc: "온갖 재료가 들어간 숲 스타일 쏨땀", category: "쏨땀", price: 15000 },
            { name: "땀 타드", thai: "ตำถาด", desc: "쟁반 쏨땀 - 다양한 사이드 포함", category: "쏨땀", price: 20000 },
            { name: "랍 무쌉", thai: "ลาบหมูสับ", desc: "다진 돼지고기 허브 무침", category: "이싼 음식", price: 12000 },
            { name: "랍 플라믁", thai: "ลาบปลาหมึก", desc: "오징어 허브 무침", category: "이싼 음식", price: 15000 },
            { name: "남똑 커무양", thai: "น้ำตกคอหมูย่าง", desc: "항정살 구이 무침", category: "이싼 음식", price: 15000 },
            { name: "숩 너마이", thai: "ซุบหน่อไม้", desc: "죽순 무침", category: "이싼 음식", price: 13000 },
            { name: "똠쌥 크라둑 언", thai: "ต้มแซ่บกระดูกอ่อน", desc: "돼지 연골 매운 국", category: "이싼 음식", price: 15000 },
            { name: "똠쌥 엔 뚠", thai: "ต้มแซ่บเอ็นตุ๋น", desc: "소힘줄 매운 국", category: "이싼 음식", price: 18000 },
            { name: "깽 까이 너마이 쏨", thai: "แกงไก่หน่อไม้ดอง", desc: "닭고기 절인 죽순 커리", category: "이싼 음식", price: 13000 },
            { name: "깽 플라둑 너마이 쏨", thai: "แกงปลาดุกหน่อไม้ดอง", desc: "메기 절인 죽순 커리", category: "이싼 음식", price: 15000 },
            { name: "깽 너마이", thai: "แกงหน่อไม้", desc: "죽순 커리 - 이싼 스타일", category: "이싼 음식", price: 13000 },
            { name: "깽 헤드 루암", thai: "แกงเห็ดรวม", desc: "모듬 버섯 커리", category: "이싼 음식", price: 13000 },
            { name: "깽 옴 무", thai: "แกงอ่อมหมู", desc: "이싼식 돼지고기 허브 찌개", category: "이싼 음식", price: 13000 },
            { name: "깽 옴 까이", thai: "แกงอ่อมไก่", desc: "이싼식 닭고기 허브 찌개", category: "이싼 음식", price: 13000 },
            { name: "플라 쏨 텃", thai: "ปลาส้มทอด", desc: "발효 생선 튀김 - 시큼한 맛", category: "이싼 음식", price: 15000 },
            { name: "얌 운센 무쌉", thai: "ยำวุ้นเส้นหมูสับ", desc: "돼지고기 당면 샐러드", category: "얌", price: 13000 },
            { name: "얌 운센 보란", thai: "ยำวุ้นเส้นโบราณ", desc: "옛날식 당면 샐러드", category: "얌", price: 13000 },
            { name: "얌 운센 루암밋", thai: "ยำวุ้นเส้นรวมมิตร", desc: "모듬 당면 샐러드", category: "얌", price: 15000 },
            { name: "얌 루암밋", thai: "ยำรวมมิตร", desc: "모듬 샐러드", category: "얌", price: 15000 },
            { name: "얌 탈레", thai: "ยำทะเล", desc: "해산물 샐러드", category: "얌", price: 15000 },
            { name: "얌 무요", thai: "ยำหมูยอ", desc: "태국 소시지 샐러드", category: "얌", price: 13000 },
            { name: "얌 싸이 딴", thai: "ยำไส้ตัน", desc: "돼지 아기보 샐러드", category: "얌", price: 13000 },
            { name: "얌 무요+카이댕켐 (쁠라라)", thai: "ยำหมูยอ+ไข่แดงเค็ม (ปลาร้า)", desc: "무요+노른자 젓갈 무침", category: "얌", price: 15000 },
            { name: "얌 꿍 솟 (쁠라라)", thai: "ยำกุ้งสด (ปลาร้า)", desc: "생새우 젓갈 무침", category: "얌", price: 15000 },
            { name: "얌 쌜몬 (쁠라라)", thai: "ยำแซลมอน (ปลาร้า)", desc: "연어 젓갈 무침", category: "얌", price: 15000 },
            { name: "얌 허이 크랭 (쁠라라)", thai: "ยำหอยแครง (ปลาร้า)", desc: "꼬막 젓갈 무침", category: "얌", price: 15000 },
            { name: "얌 뿌마 솟 (쁠라라)", thai: "ยำปูม้าสด (ปลาร้า)", desc: "생꽃게 젓갈 무침", category: "얌", price: 15000 },
            { name: "무 뎃 디여우", thai: "หมูแดดเดียว", desc: "말린 돼지고기 튀김", category: "튀김/구이", price: 12000 },
            { name: "느아 뎃 디여우", thai: "เนื้อแดดเดียว", desc: "말린 소고기 튀김", category: "튀김/구이", price: 13000 },
            { name: "픽 까이 텃 남플라", thai: "ปีกไก่ทอดน้ำปลา", desc: "닭날개 피쉬소스 튀김", category: "튀김/구이", price: 13000 },
            { name: "꼽 텃 크라티얌", thai: "กบทอดกระเทียม", desc: "개구리 마늘 튀김", category: "튀김/구이", price: 15000 },
            { name: "싸이 크럭 이싼", thai: "ไส้กรอกอีสาน", desc: "이싼 소시지", category: "튀김/구이", price: 13000 },
            { name: "냄 무 쌈찬 텃", thai: "แหนมหมูสามชั้นทอด", desc: "시큼한 삼겹살 튀김", category: "튀김/구이", price: 13000 },
            { name: "냄 픽 까이 텃", thai: "แหนมปีกไก่ทอด", desc: "시큼한 닭날개 튀김", category: "튀김/구이", price: 13000 },
            { name: "플라믁 양", thai: "ปลาหมึกย่าง", desc: "오징어 구이", category: "튀김/구이", price: 15000 },
            { name: "플라둑 양", thai: "ปลาดุกย่าง", desc: "메기 구이", category: "튀김/구이", price: 10000 },
            { name: "느아 까이 양", thai: "เนื้อไก่ย่าง", desc: "닭고기 꼬치 구이 - 5개", category: "튀김/구이", price: 10000 },
            { name: "뗍 까이 삥", thai: "ตับไก่ปิ้ง", desc: "닭 간 구이 - 5개", category: "튀김/구이", price: 10000 },
            { name: "룩친 루암 삥", thai: "ลูกชิ้นรวมปิ้ง", desc: "모듬 완자 꼬치 구이 - 5개", category: "튀김/구이", price: 10000 },
            { name: "미양 허이 크랭", thai: "เมี่ยงหอยแครง", desc: "꼬막 쌈 세트", category: "쌈 / 샤브샤브 / 무카타", price: 15000 },
            { name: "미양 탈레 루암", thai: "เมี่ยงทะเลรวม", desc: "해산물 쌈 세트", category: "쌈 / 샤브샤브 / 무카타", price: 18000 },
            { name: "미양 플라투", thai: "เมี่ยงปลาทู", desc: "고등어 쌈 세트", category: "쌈 / 샤브샤브 / 무카타", price: 15000 },
            { name: "미양 무 쌈찬", thai: "เมี่ยงหมูสามชั้น", desc: "삼겹살 쌈 세트", category: "쌈 / 샤브샤브 / 무카타", price: 15000 },
            { name: "미양 플라 탑팀 파오", thai: "เมี่ยงปลาทับทิมเผา", desc: "붉은 틸라피아 구이 쌈", category: "쌈 / 샤브샤브 / 무카타", price: 30000 },
            { name: "미양 플라 탑팀 능", thai: "เมี่ยงปลาทับทิมนึ่ง", desc: "붉은 틸라피아 찜 쌈", category: "쌈 / 샤브샤브 / 무카타", price: 30000 },
            { name: "찜쭘 무 막", thai: "จิ้มจุ่มหมูหมาก", desc: "돼지고기 태국식 샤브샤브", category: "쌈 / 샤브샤브 / 무카타", price: 29000 },
            { name: "찜쭘 느아 막", thai: "จิ้มจุ่มเนื้อหมาก", desc: "소고기 태국식 샤브샤브", category: "쌈 / 샤브샤브 / 무카타", price: 35000 },
            { name: "춋 루암 무카타", thai: "ชุดรวมหมูกระทะ", desc: "무카타 돼지고기 세트 - 태국식 불고기", category: "쌈 / 샤브샤브 / 무카타", price: 35000 },
            { name: "카오 무댕", thai: "ข้าวหมูแดง", desc: "붉은 돼지고기 덮밥", category: "스페셜 메뉴", price: 12000 },
            { name: "카오 카무", thai: "ข้าวขาหมู", desc: "태국식 족발 덮밥", category: "스페셜 메뉴", price: 15000 },
            { name: "카오 만 까이", thai: "ข้าวมันไก่", desc: "태국식 치킨 라이스", category: "스페셜 메뉴", price: 12000 },
            { name: "카오 무껍", thai: "ข้าวหมูกรอบ", desc: "바삭한 삼겹살 덮밥", category: "스페셜 메뉴", price: 15000 },
            { name: "호목 탈레", thai: "ห่อหมกทะเล", desc: "해산물 커리 찜", category: "스페셜 메뉴", price: 15000 },
            { name: "꾸어이띠여우 느아 뚠", thai: "ก๋วยเตี๋ยวเนื้อตุ๋น", desc: "소고기 갈비 국수", category: "스페셜 메뉴", price: 15000 },
            { name: "꾸어이띠여우 무 뚠", thai: "ก๋วยเตี๋ยวหมูตุ๋น", desc: "돼지고기 갈비 국수", category: "스페셜 메뉴", price: 13000 },
            { name: "카놈찐 남니여우", thai: "ขนมจีนน้ำเงี้ยว", desc: "북부식 선지 국수", category: "스페셜 메뉴", price: 15000 },
            { name: "카오 쏘이 까이", thai: "ข้าวซอยไก่", desc: "치앙마이 카레 국수 - 닭고기", category: "스페셜 메뉴", price: 15000 },
            { name: "카놈 찝 꿍", thai: "ขนมจีบกุ้ง", desc: "새우 슈마이/딤섬", category: "간식 / 디저트", price: 7000 },
            { name: "카놈 찝 꿍 카이켐", thai: "ขนมจีบกุ้งไข่เค็ม", desc: "새우 & 쏠티드 에그 슈마이", category: "간식 / 디저트", price: 7500 },
            { name: "카놈 투어이", thai: "ขนมถ้วย", desc: "코코넛 밀크 푸딩", category: "간식 / 디저트", price: 6000 },
            { name: "부아 러이 เผือก", thai: "บัวลอยเผือก", desc: "타로 펄 코코넛 밀크", category: "간식 / 디저트", price: 6000 },
            { name: "탑팀 크롭", thai: "ทับทิมกรอบ", desc: "물밤 디저트", category: "간식 / 디저트", price: 6000 },
            { name: "클루어이 텃", thai: "กล้วยทอด", desc: "바나나 튀김", category: "간식 / 디저트", price: 9000 },
            { name: "만 텃", thai: "มันทอด", desc: "고구마/감자 튀김", category: "간식 / 디저트", price: 9000 },
            { name: "차 옌", thai: "ชาเย็น", desc: "태국식 밀크티", category: "음료", price: 5000 },
            { name: "차 키여우", thai: "ชาเขียว", desc: "태국식 그린 밀크티", category: "음료", price: 5000 },
            { name: "오리양", thai: "โอเลี้ยง", desc: "태국식 블랙 커피", category: "음료", price: 5000 },
            { name: "껙후어이", thai: "แคคฮวย", desc: "국화차", category: "음료", price: 5000 },
            { name: "남 람야이", thai: "น้ำลำไย", desc: "용안 주스", category: "음료", price: 5000 }
    ];

    const CATEGORY_META = [
      { key: "rice_bowls", ko: "덮밥류", en: "Rice Bowl Dishes", th: "เมนูราดข้าว", aliases: ["덮밥류"], icon: "rice_bowl" },
      { key: "main", ko: "메인요리", en: "Main Dishes", th: "เมนูหลัก", aliases: ["메인 요리", "메인요리"], icon: "restaurant" },
      { key: "noodle", ko: "면 요리", en: "Noodle Dishes", th: "เมนูเส้น", aliases: ["면 요리", "면요리"], icon: "ramen_dining" },
      { key: "soups_curries", ko: "찌개·국·커리", en: "Soups & Curries", th: "ต้ม & แกง", aliases: ["찌개/국/커리", "찌개·국·커리"], icon: "soup_kitchen" },
      { key: "som_tam", ko: "쏨땀", en: "Papaya Salad", th: "ส้มตำ", aliases: ["쏨땀"], icon: "eco" },
      { key: "isan", ko: "이싼 음식", en: "Isan Cuisine", th: "อาหารอีสาน", aliases: ["이싼 음식"], icon: "local_fire_department" },
      { key: "yam", ko: "얌", en: "Thai Spicy Salad", th: "ยำ", aliases: ["얌"], icon: "spa" },
      { key: "fried_grilled", ko: "튀김·구이 (안주류)", en: "Fried & Grilled", th: "ของทอด & ของย่าง", aliases: ["튀김/구이", "튀김·구이 (안주류)"], icon: "set_meal" },
      { key: "wraps_shabu_mukata", ko: "쌈 · 샤브샤브 · 무카타", en: "Wraps · Shabu-Shabu · Thai BBQ", th: "หมูกระทะ & ชาบู", aliases: ["쌈 / 샤브샤브 / 무카타", "쌈 · 샤브샤브 · 무카타"], icon: "outdoor_grill" },
      { key: "special", ko: "스페셜 메뉴", en: "Special Menu", th: "เมนูพิเศษ", aliases: ["스페셜 메뉴"], icon: "auto_awesome" },
      { key: "snacks_desserts", ko: "간식 · 디저트", en: "Snacks & Desserts", th: "ของทานเล่น & ของหวาน", aliases: ["간식 / 디저트", "간식 · 디저트"], icon: "icecream" },
      { key: "beverages", ko: "음료", en: "Beverages", th: "เครื่องดื่ม", aliases: ["음료"], icon: "local_bar" }
    ];

    const UI_TEXT = {
      ko: {
        htmlLang: "ko",
        pageTitle: "태국 메뉴판",
        pageDesc: "카테고리별로 메뉴를 확인하고 검색으로 빠르게 찾으세요.",
        search: "메뉴 검색",
        brandSub: "Digital Menu Board",
        theme: "테마 전환",
        noResult: "검색 결과가 없습니다.",
        cartTitle: "장바구니",
        cartHint: "메뉴를 추가하고 주문을 진행하세요.",
        cartEmpty: "장바구니가 비어 있습니다.",
        cartBtn: "장바구니",
        addToCart: "담기",
        subtotal: "합계",
        clearCart: "비우기",
        removeItem: "삭제",
        orderNow: "주문하기",
        orderInfo: "주문 정보",
        customerName: "주문자명",
        tableNo: "테이블 번호",
        phone: "연락처",
        request: "요청사항",
        orderTotal: "주문 합계",
        cancel: "취소",
        submitOrder: "주문 접수",
        requiredTable: "테이블 번호를 입력해 주세요.",
        orderSuccess: "주문이 접수되었습니다. 감사합니다."
      },
      en: {
        htmlLang: "en",
        pageTitle: "Thai Menu Board",
        pageDesc: "Browse by category and find dishes quickly with search.",
        search: "Search menu",
        brandSub: "Digital Menu Board",
        theme: "Toggle Theme",
        noResult: "No results found.",
        cartTitle: "Cart",
        cartHint: "Add menu items and proceed to checkout.",
        cartEmpty: "Your cart is empty.",
        cartBtn: "Cart",
        addToCart: "Add",
        subtotal: "Subtotal",
        clearCart: "Clear",
        removeItem: "Remove",
        orderNow: "Order",
        orderInfo: "Order Details",
        customerName: "Customer Name",
        tableNo: "Table No.",
        phone: "Phone",
        request: "Request",
        orderTotal: "Order Total",
        cancel: "Cancel",
        submitOrder: "Place Order",
        requiredTable: "Please enter table number.",
        orderSuccess: "Order has been placed. Thank you."
      },
      th: {
        htmlLang: "th",
        pageTitle: "เมนูอาหารไทย",
        pageDesc: "เลือกดูเมนูตามหมวดหมู่และค้นหาได้อย่างรวดเร็ว",
        search: "ค้นหาเมนู",
        brandSub: "Digital Menu Board",
        theme: "เปลี่ยนธีม",
        noResult: "ไม่พบผลลัพธ์",
        cartTitle: "ตะกร้า",
        cartHint: "เพิ่มเมนูและทำรายการสั่งอาหาร",
        cartEmpty: "ไม่มีสินค้าในตะกร้า",
        cartBtn: "ตะกร้า",
        addToCart: "เพิ่ม",
        subtotal: "รวม",
        clearCart: "ล้าง",
        removeItem: "ลบ",
        orderNow: "สั่งอาหาร",
        orderInfo: "ข้อมูลการสั่งอาหาร",
        customerName: "ชื่อลูกค้า",
        tableNo: "โต๊ะ",
        phone: "เบอร์โทร",
        request: "หมายเหตุ",
        orderTotal: "ยอดรวมคำสั่งซื้อ",
        cancel: "ยกเลิก",
        submitOrder: "ยืนยันคำสั่งซื้อ",
        requiredTable: "กรุณากรอกหมายเลขโต๊ะ",
        orderSuccess: "รับคำสั่งซื้อเรียบร้อย ขอบคุณค่ะ"
      }
    };

    const aliasToMeta = new Map();
    CATEGORY_META.forEach((meta) => meta.aliases.forEach((alias) => aliasToMeta.set(alias, meta)));

    const normalizedMenu = menuData.map((item, index) => {
      const meta = aliasToMeta.get(item.category);
      return { ...item, id: `m-${index}`, categoryKey: meta ? meta.key : "unknown" };
    });

    const categories = CATEGORY_META.filter((meta) => normalizedMenu.some((item) => item.categoryKey === meta.key));

    let currentLang = "ko";
    let currentSearch = "";
    let activeCategoryKey = categories[0]?.key || "";
    const FALLBACK_SVG = "data:image/svg+xml;utf8," + encodeURIComponent(
      "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 240'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%23B61E2E'/><stop offset='100%' stop-color='%23D4AF37'/></linearGradient></defs><rect width='320' height='240' fill='url(%23g)'/><circle cx='72' cy='64' r='38' fill='rgba(255,255,255,.22)'/><circle cx='262' cy='178' r='52' fill='rgba(255,255,255,.16)'/><text x='24' y='210' fill='white' font-size='22' font-family='Arial'>Thai Menu</text></svg>"
    );
    const ALT_SEP = "@@";

    const navEl = document.getElementById("categoryNav");
    const sectionsEl = document.getElementById("menuSections");
    const searchInput = document.getElementById("searchInput");
    const cartItemsEl = document.getElementById("cartItems");
    const cartSubtotalEl = document.getElementById("cartSubtotal");
    const cartJumpCountEl = document.getElementById("cartJumpCount");
    const orderModalEl = document.getElementById("orderModal");
    const modalOrderTotalEl = document.getElementById("modalOrderTotal");
    const orderFormEl = document.getElementById("orderForm");
    const clearCartBtn = document.getElementById("clearCartBtn");
    const orderBtn = document.getElementById("orderBtn");
    const ORDER_CART_KEY = "hphour_cart_v1";
    const ORDER_HISTORY_KEY = "hphour_orders_v1";

    let cart = {};

    function t(key) {
      return UI_TEXT[currentLang][key];
    }

    function getCategoryName(meta) {
      return meta[currentLang] || meta.ko;
    }

    function formatPrice(price) {
      if (currentLang === "en") return `KRW ${price.toLocaleString("en-US")}`;
      if (currentLang === "th") return `${price.toLocaleString("th-TH")} วอน`;
      return `${price.toLocaleString("ko-KR")}원`;
    }

    function getMenuById(id) {
      return normalizedMenu.find((item) => item.id === id);
    }

    function loadCart() {
      try {
        const raw = localStorage.getItem(ORDER_CART_KEY);
        cart = raw ? JSON.parse(raw) : {};
      } catch {
        cart = {};
      }
    }

    function saveCart() {
      localStorage.setItem(ORDER_CART_KEY, JSON.stringify(cart));
    }

    function getCartEntries() {
      return Object.entries(cart)
        .map(([id, qty]) => ({ item: getMenuById(id), qty }))
        .filter((x) => x.item && x.qty > 0);
    }

    function getCartCount() {
      return getCartEntries().reduce((acc, row) => acc + row.qty, 0);
    }

    function getCartTotal() {
      return getCartEntries().reduce((acc, row) => acc + row.item.price * row.qty, 0);
    }

    function addToCart(itemId) {
      cart[itemId] = (cart[itemId] || 0) + 1;
      saveCart();
      renderCart();
    }

    function changeQty(itemId, delta) {
      const next = (cart[itemId] || 0) + delta;
      if (next <= 0) {
        delete cart[itemId];
      } else {
        cart[itemId] = next;
      }
      saveCart();
      renderCart();
    }

    function clearCart() {
      cart = {};
      saveCart();
      renderCart();
    }

    function renderCart() {
      const entries = getCartEntries();
      const total = getCartTotal();
      cartSubtotalEl.textContent = formatPrice(total);
      modalOrderTotalEl.textContent = formatPrice(total);
      cartJumpCountEl.textContent = String(getCartCount());

      if (entries.length === 0) {
        cartItemsEl.innerHTML = `<div class="rounded-lg border border-dashed border-slate-300 dark:border-zinc-700 bg-slate-50 dark:bg-zinc-800/50 px-3 py-6 text-center text-sm text-slate-500">${t("cartEmpty")}</div>`;
        return;
      }

      cartItemsEl.innerHTML = entries.map(({ item, qty }) => `
        <article class="rounded-lg border border-slate-200 dark:border-zinc-800 p-3">
          <div class="flex items-start justify-between gap-2">
            <h4 class="text-sm font-semibold leading-tight">${localName(item)}</h4>
            <strong class="text-sm text-primary whitespace-nowrap">${formatPrice(item.price * qty)}</strong>
          </div>
          <p class="text-xs text-slate-500 mt-1">${subName(item)}</p>
          <div class="mt-2 flex items-center justify-between">
            <div class="inline-flex items-center rounded-lg border border-slate-200 dark:border-zinc-700 overflow-hidden">
              <button class="cart-dec px-2 py-1 text-sm hover:bg-slate-100 dark:hover:bg-zinc-800" data-id="${item.id}">-</button>
              <span class="px-3 py-1 text-sm">${qty}</span>
              <button class="cart-inc px-2 py-1 text-sm hover:bg-slate-100 dark:hover:bg-zinc-800" data-id="${item.id}">+</button>
            </div>
            <button class="cart-remove text-xs text-slate-500 hover:text-primary" data-id="${item.id}">${t("removeItem")}</button>
          </div>
        </article>
      `).join("");
    }

    function slugify(name) {
      return name
        .toLowerCase()
        .replace(/[^\w\u3131-\uD79D]+/g, "-")
        .replace(/^-+|-+$/g, "");
    }

    // 3+2 strategy:
    // 3) local image mapping by filename (webp/jpg/png)
    // 2) generated placeholder fallback
    function getMenuImageSources(item) {
      const slug = slugify(item.name);
      return [
        `./images/menu/${slug}.webp`,
        `./images/menu/${slug}.jpg`,
        `./images/menu/${slug}.png`
      ];
    }

    function handleImgError(imgEl) {
      const next = (imgEl.dataset.alt || "").split(ALT_SEP).filter(Boolean);
      if (next.length === 0) {
        imgEl.onerror = null;
        imgEl.src = FALLBACK_SVG;
        return;
      }
      imgEl.src = next.shift();
      imgEl.dataset.alt = next.join(ALT_SEP);
    }

    function localName(item) {
      if (currentLang === "th") return item.thai || item.name;
      return item.name;
    }

    function subName(item) {
      if (currentLang === "th") return item.name;
      return item.thai;
    }

    function applyUITexts() {
      document.documentElement.lang = UI_TEXT[currentLang].htmlLang;
      document.getElementById("pageTitle").textContent = t("pageTitle");
      document.getElementById("pageDesc").textContent = t("pageDesc");
      document.getElementById("searchInput").placeholder = t("search");
      document.getElementById("brandSub").textContent = t("brandSub");
      document.getElementById("themeLabel").textContent = t("theme");
      document.getElementById("cartTitle").textContent = t("cartTitle");
      document.getElementById("cartHint").textContent = t("cartHint");
      document.getElementById("cartJumpText").textContent = t("cartBtn");
      document.getElementById("subtotalLabel").textContent = t("subtotal");
      document.getElementById("clearCartBtn").textContent = t("clearCart");
      document.getElementById("orderBtn").textContent = t("orderNow");
      document.getElementById("orderTitle").textContent = t("orderInfo");
      document.getElementById("customerNameLabel").textContent = t("customerName");
      document.getElementById("tableLabel").textContent = t("tableNo");
      document.getElementById("phoneLabel").textContent = t("phone");
      document.getElementById("requestLabel").textContent = t("request");
      document.getElementById("orderTotalLabel").textContent = t("orderTotal");
      document.getElementById("cancelOrderBtn").textContent = t("cancel");
      document.getElementById("submitOrderBtn").textContent = t("submitOrder");

      document.querySelectorAll(".lang-btn").forEach((btn) => {
        const isActive = btn.dataset.lang === currentLang;
        btn.classList.toggle("bg-primary", isActive);
        btn.classList.toggle("text-white", isActive);
      });
    }

    function filteredItems() {
      const q = currentSearch.trim().toLowerCase();
      if (!q) return normalizedMenu;
      return normalizedMenu.filter((item) => {
        const meta = CATEGORY_META.find((x) => x.key === item.categoryKey);
        const catText = meta ? `${meta.ko} ${meta.en} ${meta.th}`.toLowerCase() : "";
        return (
          item.name.toLowerCase().includes(q) ||
          item.thai.toLowerCase().includes(q) ||
          item.desc.toLowerCase().includes(q) ||
          catText.includes(q)
        );
      });
    }

    function renderNav(items) {
      const counts = items.reduce((acc, item) => {
        acc[item.categoryKey] = (acc[item.categoryKey] || 0) + 1;
        return acc;
      }, {});

      navEl.innerHTML = categories
        .map((meta, i) => {
          const count = counts[meta.key] || 0;
          const active = meta.key === activeCategoryKey ? "active-cat" : "text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-zinc-800";
          return `
            <a href="#cat-${meta.key}" data-key="${meta.key}" class="cat-link flex items-center justify-between px-4 py-3 text-sm font-medium rounded-lg transition ${active}">
              <span class="flex items-center gap-2"><span class="material-icons text-lg">${meta.icon}</span> ${i + 1}. ${getCategoryName(meta)}</span>
              <span class="text-xs opacity-80">${count}</span>
            </a>
          `;
        })
        .join("");

      navEl.querySelectorAll(".cat-link").forEach((a) => {
        a.addEventListener("click", () => {
          activeCategoryKey = a.dataset.key;
          renderNav(items);
        });
      });
    }

    function renderSections(items) {
      const grouped = new Map();
      categories.forEach((meta) => grouped.set(meta.key, []));
      items.forEach((item) => {
        if (!grouped.has(item.categoryKey)) return;
        grouped.get(item.categoryKey).push(item);
      });

      const blocks = categories
        .map((meta, i) => {
          const list = grouped.get(meta.key) || [];
          if (list.length === 0) return "";
          return `
            <section id="cat-${meta.key}" class="scroll-mt-6">
              <div class="flex items-center mb-5">
                <h3 class="text-xl font-bold mr-4">${i + 1}. ${getCategoryName(meta)}</h3>
                <div class="h-px flex-1 bg-slate-200 dark:bg-zinc-800"></div>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 2xl:grid-cols-3 gap-5">
                ${list
                  .map((item) => `
                    ${(() => {
                      const imageSources = getMenuImageSources(item);
                      const primaryImage = imageSources[0] || FALLBACK_SVG;
                      const altImageList = imageSources.slice(1).join(ALT_SEP);
                      return `
                    <article class="bg-white dark:bg-zinc-900 p-4 rounded-xl border border-slate-100 dark:border-zinc-800 shadow-sm hover:shadow-md transition group flex gap-4">
                      <div class="w-24 h-24 flex-shrink-0 bg-slate-100 dark:bg-zinc-800 rounded-lg overflow-hidden relative">
                        <img src="${primaryImage}" data-alt="${altImageList}" alt="${localName(item)}" loading="lazy" class="w-full h-full object-cover" onerror="handleImgError(this)" />
                        <div class="absolute inset-0 bg-black/5 group-hover:bg-transparent transition-colors"></div>
                      </div>
                      <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start gap-3 mb-1">
                          <h4 class="font-bold text-lg leading-tight">${localName(item)}</h4>
                          <span class="text-primary font-bold whitespace-nowrap">${formatPrice(item.price)}</span>
                        </div>
                        <p class="text-xs text-slate-400 dark:text-zinc-500 mb-1 thai-script">${subName(item)}</p>
                        <p class="text-sm text-slate-600 dark:text-zinc-400">${item.desc}</p>
                        <div class="mt-3">
                          <button class="add-cart-btn inline-flex items-center gap-1 rounded-lg bg-primary text-white px-3 py-1.5 text-xs font-semibold hover:opacity-95" data-id="${item.id}">
                            <span class="material-icons text-sm">add_shopping_cart</span>
                            <span>${t("addToCart")}</span>
                          </button>
                        </div>
                      </div>
                    </article>
                      `;
                    })()}
                  `)
                  .join("")}
              </div>
            </section>
          `;
        })
        .join("");

      sectionsEl.innerHTML = blocks || `<div class="rounded-xl border border-dashed border-slate-300 dark:border-zinc-700 bg-white/70 dark:bg-zinc-900/40 px-6 py-10 text-center text-slate-500">${t("noResult")}</div>`;
    }

    function render() {
      applyUITexts();
      const items = filteredItems();
      renderNav(items);
      renderSections(items);
      renderCart();
    }

    searchInput.addEventListener("input", (e) => {
      currentSearch = e.target.value;
      render();
    });

    document.querySelectorAll(".lang-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        currentLang = btn.dataset.lang;
        render();
      });
    });

    document.getElementById("themeToggle").addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
    });

    sectionsEl.addEventListener("click", (e) => {
      const btn = e.target.closest(".add-cart-btn");
      if (!btn) return;
      addToCart(btn.dataset.id);
    });

    cartItemsEl.addEventListener("click", (e) => {
      const inc = e.target.closest(".cart-inc");
      if (inc) return changeQty(inc.dataset.id, 1);
      const dec = e.target.closest(".cart-dec");
      if (dec) return changeQty(dec.dataset.id, -1);
      const remove = e.target.closest(".cart-remove");
      if (remove) {
        delete cart[remove.dataset.id];
        saveCart();
        renderCart();
      }
    });

    clearCartBtn.addEventListener("click", () => clearCart());

    orderBtn.addEventListener("click", () => {
      if (getCartEntries().length === 0) return;
      orderModalEl.classList.remove("hidden");
    });

    orderModalEl.addEventListener("click", (e) => {
      if (e.target.closest("[data-close-order-modal]")) {
        orderModalEl.classList.add("hidden");
      }
    });

    orderFormEl.addEventListener("submit", (e) => {
      e.preventDefault();
      const tableNo = document.getElementById("tableInput").value.trim();
      if (!tableNo) {
        alert(t("requiredTable"));
        return;
      }

      const orderPayload = {
        orderId: `ORD-${Date.now()}`,
        createdAt: new Date().toISOString(),
        customerName: document.getElementById("customerNameInput").value.trim(),
        tableNo,
        phone: document.getElementById("phoneInput").value.trim(),
        request: document.getElementById("requestInput").value.trim(),
        lang: currentLang,
        items: getCartEntries().map(({ item, qty }) => ({
          id: item.id,
          name: item.name,
          thai: item.thai,
          price: item.price,
          qty
        })),
        total: getCartTotal()
      };

      const orders = JSON.parse(localStorage.getItem(ORDER_HISTORY_KEY) || "[]");
      orders.push(orderPayload);
      localStorage.setItem(ORDER_HISTORY_KEY, JSON.stringify(orders));

      console.log("order_submitted", orderPayload);
      orderFormEl.reset();
      orderModalEl.classList.add("hidden");
      clearCart();
      alert(t("orderSuccess"));
    });

    loadCart();
    render();
  </script>
</body>
</html>
